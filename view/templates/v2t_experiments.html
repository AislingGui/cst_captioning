{% extends 'v2t_base.html' %}

{% block body %}

{% if not data.videos %}

<form action="{{ url_for('experiments') }}" method="get">
{% if not data.dataset %}
  <div class="home-class">
      <p>Select a dataset:</p>
      <select name="dataset">
      {% for dataset in config.datasets %}
      <option value="{{ dataset }}">{{ dataset }}</option>
      {% endfor %}
      </select>
  </div>
{% else  %}
  <div class="home-class">
      <p>Dataset:</p>
      <select name="dataset">
      <option value="{{ data.dataset }}">{{ data.dataset }}</option>
      </select>
      <p>Select Experiment:</p>
      <select name="exp">
      {% for exp in config.exps %}
      <option value="{{ exp }}">{{ exp }}</option>
      {% endfor %}
      </select>
      {% if data.dataset == 'msrvtt' %}
      <p>Select Category:</p>
      <select name="category">
      {% for cat in config.categories %}
      <option value="{{ cat }}">{{ cat }}</option>
      {% endfor %}
      </select>
      {% endif %}
  </div>
{% endif %}    
<input type="submit" value="Submit">
</form>    

{% else %}
  {{ data.pagination.info }}
  {{ data.pagination.links }}
  <div class="table-responsive">
    <table class="table table-hover">
    <thead>
      <tr><th>#</th><th>Video</th><th>Predictions / Ground truth</th></tr>
    </thead>
    <tbody>
      {% for video in data.videos %}
      <tr>
      <td>{{ loop.index + (config.page - 1) * config.per_page }} [video{{video.id}}]</td>
      <td>
          <!-- <img src='{{ url_for('static', filename = video.keyframe) }}' 
               alt='{{ video.video_id }}' BORDER='0'/> -->
         <video id="{{ video.id }}" class="video-js" controls preload="auto" width="320" height="240"
  poster="{{ url_for('static', filename=video.keyframe) }}" data-setup="{}">
    <source src="{{ url_for('static', filename=video.videopath) }}" type='video/mp4'>
    <p class="vjs-no-js">
      To view this video please enable JavaScript, and consider upgrading to a web browser that
      <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
    </p>
  </video> 
          </td>
          <td>
              <table>
                  <tr><h4>Predictions:</h4></tr>
                  {% for key,caption in video.captions.iteritems() %}
                  <tr>
          <th>{{ key }} </th>
            <td>-- {{ caption }}</td>
                  </tr>
          {% endfor %}
    </table>
             
              {% if data.topics %}
               <table>
                  <tr><h4>Topics:  </h4></tr>
                  <tr>
                      {% for key,topics in video.pred_topics.iteritems() %}
                      
                      <td> <canvas id="{{video.id}}{{key}}" width="200" height="200"></canvas> </td>
                      {% endfor %}
                  </tr>
                   <tr>
                       {% for key, topic_words in data.topiclist.iteritems() %}
                       <td> 
                           <ol>
                           {% for words in topic_words %}
                           <li> {{ words }} </li>
                           {% endfor %}
                               </ol>
                       </td>
                       {% endfor %}
                   </tr>
    </table>
              
              
{% for key,topics in video.pred_topics.iteritems() %}
<script>
      // Global parameters:
// do not resize the chart canvas when its container does (keep at 600x400px)
Chart.defaults.global.responsive = false;
// define the chart data
var data = {
  labels : [{% for item in data.topics %}
             "{{item}}",
            {% endfor %}],
  datasets : [{
      label: '{{ key }}',
      fill: true,
      lineTension: 0.1,
      backgroundColor: "rgba(75,192,192,0.4)",
      borderColor: "rgba(75,192,192,1)",
      borderCapStyle: 'butt',
      borderDash: [],
      borderDashOffset: 0.0,
      borderJoinStyle: 'miter',
      pointBorderColor: "rgba(75,192,192,1)",
      pointBackgroundColor: "#fff",
      pointBorderWidth: 1,
      pointHoverRadius: 5,
      pointHoverBackgroundColor: "rgba(75,192,192,1)",
      pointHoverBorderColor: "rgba(220,220,220,1)",
      pointHoverBorderWidth: 2,
      pointRadius: 1,
      pointHitRadius: 10,
      data : [{% for item in topics %}
                {{item}},
              {% endfor %}],
      spanGaps: false
  }]
}
 
// get chart canvas
var ctx = document.getElementById("{{video.id}}{{key}}").getContext("2d");
 
// create the chart using the chart canvas
var myChart = new Chart(ctx, {
    type: 'bar',
    data: data,
    options: {
        //legend: {
        //    display: false
        //},
        barValueSpacing: 20,
        scales: {
            yAxes: [{
                ticks: {
                    min: 0,
                    max: 0.4
                }
            }]
        }
    }
});
    </script>
{% endfor %}
{% endif %}              
              
              <!--
              <table>
                  <tr><h4>Ground truth:</h4></tr>
                  {% for caption in video.gold_captions %}
                  <tr>
                    <td> {{ caption }}</td>
                  </tr>
                  {% endfor %}
                </table>
                -->
          </td>
      </tr>
      {% endfor %}
    </tbody>
    </table>
  </div>
  {{ data.pagination.links }}
{% endif %}

{% endblock %}

{% block js %}


  {% if active_url %}
    $('#{{ active_url }}').addClass('active');
  {% else %}
  $('#videos-url').addClass('active');
  {% endif %}
{% endblock %}
